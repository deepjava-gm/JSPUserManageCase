/*
 * BlackBox - jQuery Plugin
 * version: 1.2 (29/04/2013)
 * @requires jQuery v1.4 or later
 *
 *
 * Copyright 2013 Vincent Ting
 * Website http://vincenting.com/
 * License : MIT License / GPL License
 *
 */

!function(){var a=this,b=0,c=[],d={},e=$(window),f=function(){this.init.apply(this,arguments)};f.fn=f.prototype,f.fn.init=function(a){var b={clickOverlayEffect:"shake",overlayColor:"#000",overlayOpacity:.6,allowPromptBlank:!1,displayClose:!0,enableKeyPress:!0};if(a&&"[object Object]"==Object.prototype.toString.call(a)){var c={};jQuery.each(b,function(b,d){c[b]=a[b]||d}),this.config=c}else this.config=b;this.config.enableKeyPress&&i.call(this)},f.fn.load=function(a,b,c){if(0!==arguments.length){if(b=b||$.noop,c){if(function(){for(var a in d)if(d.hasOwnProperty(a))return!1;return!0}())return k.call(this),void 0}else{if("[object Array]"==Object.prototype.toString.call(d[a]))return d[a].push(b),void 0;d[a]=[b];for(var f in d)if(f!==a)return}if(1===arguments.length&&Array.prototype.push.call(arguments,b),j.call(this,"load",arguments,c)||c){$("#BlackBox").append('<div id="BlackBoxLoad">载入中</div>');var g=$("#BlackBoxLoad").fadeTo(0,0).fadeTo(400,1),h=function(){g.css({left:(e.width()-g.width())/2,top:(e.height()-g.height())/2})};h.call(this),e.resize(h)}}},f.fn.ready=function(a){if(0!==arguments.length){var b=d[a];if(b)for(var e=0;e<b.length;e++){var f=b[e];f.call(this)}delete d[a];for(var g in d)if(d.hasOwnProperty(g))return;if("load"===c[0].type){var h=this;$("#BlackBoxLoad").fadeTo(400,0,function(){$(this).remove(),k.call(h)})}}},f.fn.loadClear=function(a){a=a||$.noop;for(var b in d)d.hasOwnProperty(b)&&delete d[b];$("#BlackBoxLoad").fadeTo(400,0),k.call(this,a)},f.fn.alert=function(){if(0!==arguments.length){var e=g.apply(this,arguments);if(j.call(this,"alert",e,e[3])||e[3]){var f=$("#BlackBox");f.append('<div class = "system Inner" id="alert'+o.call(this)+'"><p>'+e[0]+"</p></div>"),h.call(this,$("#alert"+o.call(this)),e[2]),l.call(this),this.config.displayClose&&e[2].title&&n.call(this,e[1]),m.call(this,e[1],null,e[2])}}},f.fn.confirm=function(){if(0!==arguments.length){var e=g.apply(this,arguments);if(j.call(this,"confirm",e,e[3])||e[3]){var f=$("#BlackBox");f.append('<div class = "system Inner" id="confirm'+o.call(this)+'"><p>'+e[0]+"</p></div>"),h.call(this,$("#confirm"+o.call(this)),e[2]),l.call(this);var i=function(){return e[1].call(this,!0)},k=function(){return e[1].call(this,!1)};this.config.displayClose&&e[2].title&&n.call(this,k),m.call(this,i,k,e[2])}}},f.fn.prompt=function(){if(0!==arguments.length){var e=g.apply(this,arguments);if(j.call(this,"prompt",e,e[3])||e[3]){var f=e[2].verify||function(){return!0},i=$("#BlackBox");i.append('<div class = "system Inner" id="prompt'+o.call(this)+'"><p>'+e[0]+'</p><input id="boxInput"></div>'),h.call(this,$("#prompt"+o.call(this)),e[2]),l.call(this);var k=$("#boxInput").focus(),p=function(){return e[1].call(this,k.val())},q=function(){return e[1].call(this,null)},r=this;k.blur(function(){$(this).val($.trim($(this).val()))}),this.config.displayClose&&e[2].title&&n.call(this,q),e[2].verify=function(){return(r.config.allowPromptBlank||k.val())&&f.call(this,k.val())?!0:(k.addClass("boxError").focus(),!1)},m.call(this,p,q,e[2])}}},f.fn.popup=function(a,b,c){if(0!==arguments.length&&(b=b||$.noop,1===arguments.length&&Array.prototype.push.call(arguments,b),j.call(this,"popup",arguments,c)||c)){var d=$("#BlackBox");d.append('<div class="normal" id="popup'+o.call(this)+'">'+a+"</div>"),h.call(this,$("#popup"+o.call(this)),{}),l.call(this),b.call(this,d)}},f.fn.boxClose=function(a){var b=$("#"+o.call(this)),c=this;b[0]&&b.fadeOut(400,function(){$(this).remove(),k.call(c,a)})},f.fn.boxShake=function(){var a=$("#"+o.call(this));if(a[0]){a.stop(!0);for(var b=a.offset().left,c=1;4>=c;c++)a.animate({left:b-(12-3*c)},50),a.animate({left:b+2*(12-3*c)},50)}};var g=function(a,b,c){return b=b||$.noop,$.isFunction(b)||(c=b,b=$.noop),c=c||{},1===arguments.length&&Array.prototype.push.call(arguments,b,c),2===arguments.length&&Array.prototype.push.call(arguments,c),arguments},h=function(a,b){a.wrap('<div class="BlackBoxContent" draggable="true" id="'+o.call(this)+'"></div>');var c=$("#"+o.call(this)).fadeTo(0,0).fadeTo(400,1),d=c.width(),f=c.height(),g=function(){c.css({left:(e.width()-d)/2+"px",top:(e.height()-f-80)/2+"px"})};if(b.title){c.prepend('<p class="title">'+b.title+"</p>");var j,k,l,m,n,p,h=c,i=c.find(".title"),q=function(a){a.stopPropagation(),a.preventDefault()},r=function(a){$(document).bind("mousemove",s),$(document).bind("mouseup",t),j=n=parseFloat(h.css("left")),k=p=parseFloat(h.css("top")),l=a.pageX,m=a.pageY,q(a)},s=function(a){n=j+a.pageX-l,p=k+a.pageY-m,h.css("left",n),h.css("top",p),q(a)},t=function(a){$(document).unbind("mousemove",s),$(document).unbind("mouseup",t),q(a)};i.bind("mousedown",r)}e.resize(g),g.call(this)},i=function(){var a=this;$(document).bind("keydown.fb",function(b){var c=$(".BlackBoxContent");if(c[0])if(13==b.keyCode)c.find(".submit").click();else if(27==b.keyCode){var d=c.find(".close")[0]||c.find(".cancel")[0]||c.find(".submit")[0];d?$(d).click():a.boxClose.call(a)}})},j=function(a,d,f){if(b+=1,f||c.push({id:b,type:a,args:d}),1!==c.length)return!1;$("#BlackBox")[0]||$("body").append('<div id="BlackBox"><div id="BBOverlay"></div></div>');var g=$("#BBOverlay"),h=this.config;f||g.css({background_color:h.overlayColor}).fadeTo(0,0).fadeTo(400,h.overlayOpacity);var i=function(){g.width(e.width()+"px").height(e.height()+"px")};return i.call(this),e.resize(i),!0},k=function(a,b){if(a&&a.call(this),b?c.length=0:c.shift(),$("#BBOverlay").unbind("click"),0==c.length){var d=$("#BlackBox");if(!d[0])return;d.fadeOut(400,function(){$(this).remove()})}else Array.prototype.push.call(c[0].args,!0),this[c[0].type].apply(this,c[0].args)},l=function(){var a=this.config.clickOverlayEffect,b=$("#"+o.call(this)),c=$("#BBOverlay"),d=this;return"close"===a?(c.click(function(){var a=b.find(".close")[0]||b.find(".cancel")[0]||b.find(".submit")[0];a?$(a).click():d.boxClose.call(d)}),void 0):(c.click(function(){var a=b.find("input");1===a.length&&a.focus(),d.boxShake.call(d)}),void 0)},m=function(a,b,c){if(0!==arguments.length){var d=$("#"+o.call(this)),e=this;d.find(".Inner").append('<div id="BlackBoxAction"></div>');var f=$("#BlackBoxAction");if(b&&(f.append('<button class="cancel">取消</button>'),f.find(".cancel").click(function(){e.boxClose.call(e,b)})),a){var g=c.value||"确定";f.append('<button class="submit">'+g+"</button>"),f.find(".submit").click(function(){!c.verify||c.verify.call(e)?e.boxClose.call(e,a):e.boxShake.call(e)})}}},n=function(a){var b=$("#"+o.call(this)),c=this;b.append('<div class="close">&times;</div>'),b.find(".close").click(function(){c.boxClose.call(c,a)})},o=function(){var a=c[0].id;return"_box_"+a};a.BlackBox=f}.call(window);